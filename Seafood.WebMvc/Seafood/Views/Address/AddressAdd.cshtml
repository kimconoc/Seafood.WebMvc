@using Domain.Constant
@using Service.Helpers;
@{
    Layout = "~/Views/Shared/_LayoutAccountManager.cshtml";
    var masterDataHelper = new MasterDataHelper();
    var listRegion = masterDataHelper.GetListRegion();
}

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="~/assets/css/demo/account-manager/address-add.css" rel="stylesheet" />
    <script src="~/assets/helpers/lib/select2/select2.min.js"></script>
    <link href="~/assets/helpers/lib/select2/select2.css" rel="stylesheet" />
    <style>
        /*ghi đè class*/
        .box-address-add .form-control-address-add .input-address:focus {
            border: 1px solid rgb(7, 171, 226);
        }

        .box-address-add .form-control-address-add .textarea-address:focus {
            outline-color: rgb(7, 171, 226);
        }
    </style>
</head>

<body>
    <div class="container-address-add">
        <div class="heading">
            <h3>Thêm địa chỉ mới</h3>
        </div>
        <div class="box-address-add">
            <form>
                <div class="form-control-address-add">
                    <label class="label-address">Họ và tên:</label>
                    <input required class="input-address" placeholder="Nhập họ và tên" maxlength="60" value="Phạm Văn Đức">
                </div>
                <div class="form-control-address-add">
                    <label class="label-address">Công ty:</label>
                    <input class="input-address" placeholder="Nhập công ty" maxlength="60" value="">
                </div>
                <div class="form-control-address-add">
                    <label class="label-address">Số điện thoại:</label>
                    <input required class="input-address" placeholder="Nhập số điện thoại" maxlength="10" value="0367823445">
                </div>
                <div class="form-control-address-add">
                    <label class="label-address">Tỉnh/Thành phố:</label>
                    <select id="regionId"></select>
                    @*@Html.DropDownList("regionId", new SelectList(listRegion, "CodeRegion", "NameRegion", null))*@
                    @*<select required class="form-select" aria-label="Default select example">
                        <option disabled selected value="">Chọn Tỉnh/Thành phố</option>
                        <option value="1">Quận Ba Đình</option>
                    </select>*@
                </div>
                <div id="box_district">
                    <div class="form-control-address-add">
                        <label class="label-address">Quận huyện:</label>
                        <select id="districtId"></select>
                    </div>
                </div>
                <div id="box_ward">
                    <div class="form-control-address-add">
                        <label class="label-address">Phường xã:</label>
                        <select id="wardId"></select>
                    </div>
                </div>
                <div class="form-control-address-add">
                    <label class="label-address">Địa chỉ:</label>
                    <textarea required class="textarea-address" name="street" rows="3" maxlength="200" placeholder="Nhập địa chỉ"></textarea>
                </div>
                <div class="form-control-address-add">
                    <label class="label-address">Loại địa chỉ:</label>
                    <div class="box-check-radio-option">
                        <input type="radio" id="option_address1" name="radio_option_address" value="0" checked="checked" />
                        <label for="contactChoice1">Nhà riêng / Chung cư</label>
                        <input type="radio" id="option_address2" name="radio_option_address" value="1" />
                        <label for="contactChoice2">Cơ quan / Công ty</label>
                    </div>
                </div>
                <div class="form-control-address-add">
                    <label class="label-address"></label>
                    <div style="margin-top:-10px;" class="box-check-radio-option">
                        <input style="height:20px;width:20px;" type="checkbox" id="check_option_default" name="check_option_default">
                        <label> Đặt làm địa chỉ giao hàng</label><br>
                    </div>
                </div>
                <div class="form-control-address-add">
                    <label class="label-address"></label>
                    <div class="box-click-continue">
                        <button class="btn-core-cancle" type="button">Hủy bỏ</button>
                        <button class="btn-core-accept" type="submit">Thêm địa chỉ</button>
                    </div>
                </div>
                @*<input type="submit" value="121212" onclick="ok()">*@
            </form>
        </div>
    </div>
    <script>
        $(document).ready(function ()
        {
            $("#regionId").select2({
                placeholder: 'Chọn Tỉnh/Thành phố',
                closeOnSelect: true,// chọn 1 lần hoặc 2 lần
                matcher: matchCustom,
                ajax:
                {
                    url: '/MasterData/GetListRegion',
                    dataType: 'json',
                    data: function (params) 
                    {
                        return {
                            codeRegion: '',
                            codeDistrict: '',
                            txt: params.term,
                            defaultText: ''
                        };
                    },
                    processResults: function (data) {
                        var res = data.map(function (item) {
                            return { id: item.CodeRegion, text: item.NameRegion + '' };
                        });
                        return {
                            results: res
                        };
                    }
                }
            });
            $("#districtId").select2({
                placeholder: 'Chọn Quận/Huyện'
            });
            $("#wardId").select2({
                placeholder: 'Chọn Phường/Xã'
            });
        });
        function matchCustom(params, data) {
            // console.log(params);
            console.log(params);
            // If there are no search terms, return all of the data
            if ($.trim(params.term) === '') {
                return data;
            }

            // Do not display the item if there is no 'text' property
            if (typeof data.text === 'undefined') {
                return null;
            }

            // `params.term` should be the term that is used for searching
            // `data.text` is the text that is displayed for the data object
            if (data.text.toLowerCase().indexOf($.trim(params.term)) > -1) {
                var modifiedData = $.extend({}, data, true);
                // modifiedData.text += ' (matched)';
                // You can return modified objects from here
                // This includes matching the `children` how you want in nested data sets
                return modifiedData;
            }

            // Return `null` if the term should not be displayed
            return null;
        }

        $('#regionId').change(function ()
        {
            var boxDistrict = "<div class='form-control-address-add'>";
            boxDistrict = boxDistrict + "<label class='label-address'>Quận huyện:</label>";
            boxDistrict = boxDistrict + "<select onchange='districtChange()' id='districtId'></select>";
            boxDistrict = boxDistrict + "</div>";
            $('#box_district').html(boxDistrict);
            $("#districtId").select2({
                placeholder: 'Chọn Quận/Huyện',
                ajax:
                {
                    url: '/MasterData/GetListDistrict',
                    dataType: 'json',
                    data: function (params) {
                        return {
                            codeRegion: $('#regionId').val(),
                            codeDistrict: '',
                            txt: params.term,
                            defaultText: ''
                        };
                    },
                    processResults: function (data) {
                        var res = data.map(function (item) {
                            return { id: item.CodeDistrict, text: item.NameDistrict + '' };
                        });
                        return {
                            results: res
                        };
                    }
                }
            });

            var boxWard = "<div class='form-control-address-add'>";
            boxWard = boxWard + "<label class='label-address'>Phường xã:</label>";
            boxWard = boxWard + "<select id='wardId'></select>";
            boxWard = boxWard + "</div>";
            $('#box_ward').html(boxWard);
            $("#wardId").select2({
                placeholder: 'Chọn Phường/Xã'
            });
        });
        function districtChange()
        {
            var boxWard = "<div class='form-control-address-add'>";
            boxWard = boxWard + "<label class='label-address'>Phường xã:</label>";
            boxWard = boxWard + "<select id='wardId'></select>";
            boxWard = boxWard + "</div>";
            $('#box_ward').html(boxWard);
            $("#wardId").select2({
                placeholder: 'Chọn Phường/Xã',
                ajax:
                {
                    url: '/MasterData/GetListWard',
                    dataType: 'json',
                    data: function (params) {
                        return {
                            codeRegion: $('#regionId').val(),
                            codeDistrict: $('#districtId').val(),
                            txt: params.term,
                            defaultText: ''
                        };
                    },
                    processResults: function (data) {
                        var res = data.map(function (item) {
                            return { id: item.CodeWard, text: item.NameWard + '' };
                        });
                        return {
                            results: res
                        };
                    }
                }
            });
        }
    </script>
</body>
</html>
